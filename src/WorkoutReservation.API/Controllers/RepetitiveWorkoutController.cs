using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using WorkoutReservation.API.Controllers.Base;
using WorkoutReservation.Application.Features.RepetitiveWorkouts.Commands.CreateRepetitiveWorkout;
using WorkoutReservation.Application.Features.RepetitiveWorkouts.Commands.DeleteAllRepetitiveWorkouts;
using WorkoutReservation.Application.Features.RepetitiveWorkouts.Commands.DeleteRepetitiveWorkout;
using WorkoutReservation.Application.Features.RepetitiveWorkouts.Commands.GenerateUpcomingWorkoutTimetable;
using WorkoutReservation.Application.Features.RepetitiveWorkouts.Commands.UpdateRepetitiveWorkout;
using WorkoutReservation.Application.Features.RepetitiveWorkouts.Queries.GetRepetitiveWorkoutList;

namespace WorkoutReservation.API.Controllers;

[Authorize(Roles = "Manager, Administrator")]
[Route("api/repetitive-workout/")]
public class RepetitiveWorkoutController : ApiControllerBase
{
    [HttpGet]
    [ProducesResponseType(StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<IActionResult> GetAllRepetitiveWorkoutsPlan()
    {
        var result = await Mediator.Send(new GetRepetitiveWorkoutListQuery());
        return Ok(result);
    }

    [HttpPost]
    [ProducesResponseType(StatusCodes.Status201Created)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> CreateRepetitiveWorkout([FromBody] CreateRepetitiveWorkoutCommand command)
    {
        var repetitiveWorkoutId = await Mediator.Send(command);
        return Created($"/api/repetitive-workout/{repetitiveWorkoutId}", null);
    }

    [HttpDelete("{repetitiveWorkoutId}")]
    [ProducesResponseType(StatusCodes.Status204NoContent)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<IActionResult> DeleteRepetitiveWorkout([FromRoute] int repetitiveWorkoutId)
    {
        await Mediator.Send(new DeleteRepetitiveWorkoutCommand() { RepetitiveWorkoutId = repetitiveWorkoutId });
        return NoContent();
    }

    [HttpDelete("delete-all")]
    [ProducesResponseType(StatusCodes.Status204NoContent)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    public async Task<IActionResult> DeleteAllRepetitiveWorkout()
    {
        await Mediator.Send(new DeleteAllRepetitiveWorkoutsCommand());
        return NoContent();
    }

    [HttpPut]
    [ProducesResponseType(StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> UpdateRepetitiveWorkout([FromBody] UpdateRepetitiveWorkoutCommand command)
    {
        await Mediator.Send(command); 
        return Ok();
    }

    [HttpPost("generate-upcoming-week")]
    [Authorize(Roles = "Administrator")]
    [ProducesResponseType(StatusCodes.Status201Created)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    public async Task<IActionResult> GenerateNewUpcomingWeek()
    {
        await Mediator.Send(new GenerateUpcomingWorkoutTimetableCommand { IsAutoGenerated = false });
        return Created("New upcoming workout week was created.", null);
    }
}
